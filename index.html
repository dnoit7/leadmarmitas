<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Sorteador de Times — Pelada</title>
<style>
  :root{
    --bg:#f6f8fb;
    --card:#ffffff;
    --muted:#6b7280;
    --accent:#0ea5e9;
    --success:#10b981;
    --danger:#ef4444;
    --radius:12px;
    --gap:10px;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    background:var(--bg);
    color:#071124;
    -webkit-font-smoothing:antialiased;
    padding:18px;
  }

  .wrap{ max-width:920px; margin:0 auto; }
  h1{ text-align:center; margin:6px 0 16px; font-size:22px; }
  .card{ background:var(--card); border-radius:var(--radius); padding:14px; box-shadow:0 8px 24px rgba(3,10,18,0.06); margin-bottom:14px; }

  label.small{ font-size:13px; color:var(--muted) }
  textarea.form{ width:100%; min-height:120px; padding:10px; border-radius:10px; border:1px solid rgba(2,6,23,0.06); resize:vertical; font-size:15px }

  .controls{ display:flex; gap:var(--gap); align-items:center; flex-wrap:wrap }
  .controls .spacer{ flex:1 }

  .btn {
    display:inline-flex; align-items:center; justify-content:center;
    padding:10px 14px; border-radius:10px; border:0; cursor:pointer; font-weight:600; font-size:15px;
  }
  .btn-primary{ background:var(--accent); color:#042; }
  .btn-ghost{ background:transparent; border:1px solid rgba(2,6,23,0.06); color:var(--muted) }
  .btn-warn{ background:#f59e0b; color:#042 }
  .btn-success{ background:var(--success); color:#042 }
  .btn-danger{ background:var(--danger); color:#fff }

  .players{ margin-top:10px; display:flex; flex-direction:column; gap:10px; }
  .player-row{
    display:flex; align-items:center; gap:10px;
    padding:8px; border-radius:10px; background:rgba(2,6,23,0.02);
  }

  .player-check{ width:22px; height:22px; flex:0 0 22px; }
  .player-name{
    flex:1 1 320px; min-width:0;
    padding:10px; border-radius:8px; border:1px solid rgba(2,6,23,0.06); font-size:16px;
  }
  
  .player-level{
    flex:0 0 110px; padding:10px;
    border-radius:8px; border:1px solid rgba(2,6,23,0.06);
    font-size:15px; background:#fff;
  }
  
  .player-delete{
    padding:8px 10px;
    border-radius:8px;
    border:1px solid rgba(2,6,23,0.06);
    background:transparent;
    cursor:pointer;
  }

  .teams-grid{ display:grid; grid-template-columns:repeat(auto-fit,minmax(260px,1fr)); gap:12px; margin-top:12px }
  .team-card{ background:linear-gradient(180deg,rgba(255,255,255,0.99),rgba(255,255,255,0.96)); padding:12px; border-radius:10px; box-shadow:0 6px 18px rgba(2,6,23,0.04) }
  pre#result{ white-space:pre-wrap; background:rgba(14,165,233,0.04); padding:12px; border-radius:8px; font-size:15px; display:none; }

  .muted{ color:var(--muted); font-size:13px }
  footer{ text-align:center; color:var(--muted); font-size:13px; margin-top:8px }

  @media(max-width:640px){
    .player-row{ display:flex; flex-direction:row; gap:8px; align-items:center; }
    .player-name{ flex:1 1 200px; font-size:15px; padding:9px; }
    .player-level{ flex:0 0 92px; padding:8px; font-size:14px; }
    .controls{ flex-direction:column; gap:8px; }
    .btn{ width:100% }
    textarea.form{ min-height:160px }
    .teams-grid{ grid-template-columns:1fr; }
  }
</style>
</head>
<body>
<div class="wrap">
  <h1>Sorteador de Times — Pelada</h1>

  <!-- IMPORT -->
  <div class="card" id="importCard">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <strong>1) Cole a lista do WhatsApp</strong>
      <span class="muted small">Ex: <code>1 - Fulano</code></span>
    </div>

    <div style="margin-top:8px">
      <textarea id="rawInput" class="form" placeholder="Cole aqui a conversa/lista do grupo (ex.: 1 - João)"></textarea>
    </div>

    <div class="controls" style="margin-top:10px">
      <button class="btn btn-primary" id="btnImport">Importar lista</button>
      <button class="btn btn-ghost" id="btnClearInput">Limpar entrada</button>

      <div class="spacer"></div>

      <label class="small muted" for="teamsCount">Times</label>
      <select id="teamsCount" style="padding:8px;border-radius:8px;border:1px solid rgba(2,6,23,0.06)">
        <option>2</option><option>3</option><option>4</option><option>5</option><option>6</option>
      </select>
    </div>
  </div>

  <!-- PLAYERS -->
  <div class="card" id="playersCard">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <strong>2) Jogadores</strong>
      <span class="muted">Marque quem vai e atribua nível</span>
    </div>

    <div id="playersList" class="players" style="margin-top:10px">
      <div class="muted">Nenhum jogador importado ainda.</div>
    </div>

    <div class="controls" style="margin-top:12px">
      <button class="btn btn-success" id="btnDraw">Gerar times</button>
      <button class="btn btn-primary" id="btnCopy">Copiar Times p/ WhatsApp</button>
      <button class="btn btn-ghost" id="btnClear">Limpar lista</button>
      <button class="btn btn-danger" id="btnClearResult">Limpar resultado</button>
    </div>

    <div style="margin-top:10px" id="summary" class="muted">0 jogadores</div>
  </div>

  <!-- RESULT -->
  <div class="card">
    <strong>3) Times Gerados</strong>
    <div id="teamsContainer" class="teams-grid" style="margin-top:10px"></div>
    <div style="margin-top:10px"><pre id="result"></pre></div>
  </div>

  <footer>Salve o arquivo localmente ou publique no GitHub Pages — funciona offline.</footer>
</div>

<script>
const LS_KEY = 'sorteador_players_v4';
let players = [];

const $ = id => document.getElementById(id);

function cleanLine(line){
  let s = String(line).replace(/\r/g,'').trim();
  s = s.replace(/^\s*\d+\s*[-–\.\)]*\s*/,'');
  s = s.replace(/[^\p{L}\p{M}\p{N}\s'-]/u, '');
  s = s.replace(/\s+/g,' ').trim();
  return s;
}

function loadPlayers(){
  try {
    const raw = localStorage.getItem(LS_KEY);
    players = raw ? JSON.parse(raw) : [];
  } catch(e){ players = [] }
}
function savePlayers(){ try { localStorage.setItem(LS_KEY, JSON.stringify(players)); } catch(e){} }

function renderPlayers(){
  const container = $('playersList');
  container.innerHTML = '';
  if(players.length === 0){
    container.innerHTML = '<div class="muted">Nenhum jogador importado ainda.</div>';
    updateSummary();
    return;
  }

  players.forEach(p => {
    const row = document.createElement('div');
    row.className = 'player-row';

    const chk = document.createElement('input');
    chk.type = 'checkbox';
    chk.checked = p.selected !== false;
    chk.className = 'player-check';
    chk.addEventListener('change', ()=>{ p.selected = chk.checked; savePlayers(); updateSummary(); });

    const name = document.createElement('input');
    name.type = 'text';
    name.value = p.name;
    name.className = 'player-name';
    name.addEventListener('change', ()=>{ p.name = name.value.trim(); savePlayers(); });

    const lvl = document.createElement('select');
    lvl.className = 'player-level';
    lvl.innerHTML = `
      <option value="A">A</option>
      <option value="B">B</option>
      <option value="C">C</option>
      <option value="D">D</option>`;
    lvl.value = p.level || "C";
    lvl.addEventListener('change', ()=>{ p.level = lvl.value; savePlayers(); });

    const del = document.createElement('button');
    del.className = 'player-delete';
    del.textContent = 'Apagar';
    del.addEventListener('click', ()=>{
      if(!confirm('Apagar jogador?')) return;
      players = players.filter(x=>x.id !== p.id);
      savePlayers();
      renderPlayers();
    });

    row.appendChild(chk);
    row.appendChild(name);
    row.appendChild(lvl);
    row.appendChild(del);

    container.appendChild(row);
  });

  updateSummary();
}

function updateSummary(){
  const total = players.length;
  const selected = players.filter(p=>p.selected).length;
  $('summary').textContent = `${total} jogadores cadastrados • ${selected} selecionados`;
}

function importFromText(){
  const raw = $('rawInput').value || '';
  if(!raw.trim()){ alert('Cole a lista primeiro.'); return; }

  const lines = raw.replace(/\r/g,'').split('\n').map(l=>l.trim()).filter(Boolean);
  const extracted = [];
  for(const line of lines){
    const cleaned = cleanLine(line);
    if(cleaned) extracted.push(cleaned);
  }

  const seen = new Set();
  const unique = [];
  for(const n of extracted){
    const k = n.toLowerCase();
    if(!seen.has(k)){ seen.add(k); unique.push(n); }
  }

  unique.forEach(n=>{
    players.push({
      id: Date.now().toString(36)+Math.random().toString(36).slice(2,6),
      name:n,
      level:"C",
      selected:true
    });
  });

  savePlayers();
  renderPlayers();
}

function clearRawInput(){ $('rawInput').value = ''; }

function clearAll(){
  if(!confirm('Limpar todos os jogadores e resultados?')) return;
  players = [];
  savePlayers();
  renderPlayers();
  $('teamsContainer').innerHTML='';
  $('result').textContent='';
  $('result').style.display='none';
}

function levelToValue(level){
  return level==="A"?4 : level==="B"?3 : level==="C"?2 : 1;
}

function distributeBalanced(selected, teamsCount){
  const grouped = {A:[],B:[],C:[],D:[]};
  selected.forEach(p => grouped[p.level].push(p));

  for(const k of Object.keys(grouped))
    grouped[k] = shuffle(grouped[k]);

  const ordered = [
    ...grouped.A,
    ...grouped.B,
    ...grouped.C,
    ...grouped.D
  ];

  const teams = Array.from({length:teamsCount}, ()=>[]);
  let forward = true;
  for(let i=0;i<ordered.length;i++){
    const pos = forward ? (i%teamsCount) : (teamsCount-1-(i%teamsCount));
    teams[pos].push(ordered[i]);
    if((i+1)%teamsCount===0) forward = !forward;
  }

  return teams;
}

function shuffle(a){
  for(let i=a.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
  return a;
}

function renderTeams(teams){
  const container = $('teamsContainer');
  container.innerHTML='';

  teams.forEach((t, idx)=>{
    const card = document.createElement('div');
    card.className='team-card';

    const total = t.reduce((s,p)=>s + levelToValue(p.level), 0);

    let html = `
      <div style="display:flex;justify-content:space-between;margin-bottom:8px">
        <strong>Time ${idx+1}</strong>
        <span class="muted">Força: ${total}</span>
      </div>
      <ul style="padding-left:16px;margin:0">`;

    t.forEach(p=>{
      html += `<li style="margin-bottom:6px">${p.name} (${p.level})</li>`;
    });

    html += '</ul>';
    card.innerHTML = html;
    container.appendChild(card);
  });

  let text='';
  teams.forEach((t,i)=>{
    text += `⚽ Time ${i+1}:\n`;
    t.forEach(p => text += `• ${p.name} (${p.level})\n`);
    text += '\n';
  });

  const res = $('result');
  res.textContent = text.trim();
  res.style.display='block';
}

async function copyToWhatsApp(){
  const text = $('result').textContent || '';
  if(!text.trim()){ alert('Gere os times primeiro!'); return; }

  try{
    await navigator.clipboard.writeText(text);
    alert('Times copiados! Agora cole no WhatsApp.');
  }catch(e){
    alert('Não foi possível copiar automaticamente. Copie manualmente.');
  }
}

function generate(){
  const count = parseInt($('teamsCount').value);
  const selected = players.filter(p=>p.selected);
  if(selected.length < count){
    alert('Jogadores insuficientes para formar os times.');
    return;
  }

  const teams = distributeBalanced(selected, count);
  renderTeams(teams);
}

document.addEventListener('DOMContentLoaded', ()=>{
  loadPlayers();
  renderPlayers();

  $('btnImport').addEventListener('click', importFromText);
  $('btnClearInput').addEventListener('click', clearRawInput);
  $('btnClear').addEventListener('click', clearAll);
  $('btnDraw').addEventListener('click', generate);
  $('btnCopy').addEventListener('click', copyToWhatsApp);

  $('btnClearResult').addEventListener('click', ()=>{
    $('teamsContainer').innerHTML='';
    $('result').textContent='';
    $('result').style.display='none';
  });
});
</script>
</body>
</html>
